<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Portal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .tab-pane {
      padding: 20px;
    }
  </style>
</head>
<body>

<div class="container mt-5">
  <div class="row justify-content-center">
    <div class="col-md-6">
      <div class="card">
        <div class="card-header">
          <ul class="nav nav-tabs card-header-tabs">
            <li class="nav-item">
              <a class="nav-link active" data-bs-toggle="tab" href="#login-tab">Login</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" data-bs-toggle="tab" href="#register-tab">Register</a>
            </li>
          </ul>
        </div>
        <div class="card-body">
          <div class="tab-content">
            <div class="tab-pane fade show active" id="login-tab">
              <h5 class="card-title">Login</h5>
              <form id="loginForm">
                <div class="mb-3">
                  <label for="loginEmail" class="form-label">Email address</label>
                  <input type="email" class="form-control" id="loginEmail" required>
                </div>
                <div class="mb-3">
                  <label for="loginPassword" class="form-label">Password</label>
                  <input type="password" class="form-control" id="loginPassword" required>
                </div>
                <button type="submit" class="btn btn-primary">Login</button>
              </form>
            </div>
            <div class="tab-pane fade" id="register-tab">
              <h5 class="card-title">Register</h5>
              <form id="registerForm">
                <div class="mb-3">
                  <label for="registerEmail" class="form-label">Email address</label>
                  <input type="email" class="form-control" id="registerEmail" required>
                </div>
                <div class="mb-3">
                  <label for="registerPassword" class="form-label">Password</label>
                  <input type="password" class="form-control" id="registerPassword" required>
                </div>
                <button type="submit" class="btn btn-primary">Register</button>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
  (async () => {
    try {
      // Dynamically import the Supabase client
      const { createClient } = await import('https://cdn.skypack.dev/@supabase/supabase-js');

      // Initialize Supabase client
      const supabaseUrl = 'https://ilmufbxfsvyhpaqwdyxg.supabase.co';
      const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlsbXVmYnhmc3Z5aHBhcXdkeXhnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTgyNTk3NzcsImV4cCI6MjAzMzgzNTc3N30.XsOwbpsLN4lH6OLGR1J4jdGK-n1kOZOJhXH01MwiyPo';
      const supabase = createClient(supabaseUrl, supabaseKey);

      // Wait for Supabase client to be initialized before attaching event listeners
      await supabase.auth.signIn;

      // Login form submission
      document.getElementById('loginForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const { user, session, error } = await supabase.auth.signIn({
          email: document.getElementById('loginEmail').value,
          password: document.getElementById('loginPassword').value,
        });
        if (error) {
          alert(error.message);
        } else {
          // Redirect to admin.html or another authenticated page
          window.location.href = 'admin.html';
        }
      });

      // Register form submission
      document.getElementById('registerForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const { user, session, error } = await supabase.auth.signUp({
          email: document.getElementById('registerEmail').value,
          password: document.getElementById('registerPassword').value,
        });
        if (error) {
          alert(error.message);
        } else {
          alert('Registration successful! Please login.');
          // Optionally, you can switch to the login tab after registration
          const tab = new bootstrap.Tab(document.querySelector('#login-tab'));
          tab.show();
        }
      });
    } catch (error) {
      console.error('Error initializing Supabase:', error);
      alert('Failed to initialize Supabase. Please try again later.');
    }
  })();
</script>

</body>
</html>
